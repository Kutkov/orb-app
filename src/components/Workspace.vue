<template>
  <v-app>
    <v-content>
        <v-layout align-center justify-center>
          <v-container>
            <h1 class="font-weight-thin display-3 text-xs-center">Workspace orb app</h1>
          </v-container>
        </v-layout>
        <v-layout align-center justify-center v-if="authUser == ''">
          <v-container>
            <h2 class="font-weight-thin display-3">Войдите или зарегистрируйтесь</h2>
          </v-container>
        </v-layout>
        <v-layout align-center justify-center mb-3>
          <v-flex xs12 sm4 md3 class="text-sm-center">
            <v-text-field
              v-model="title"
              solo
              placeholder="Name"
              label="your name"
              v-if="resolveAddFlag"
            ></v-text-field>
            <v-btn
              @click="createFlag"
              :loading="loading"
              :disabled="loading"
              v-if="resolveAddFlag"
            >
              Add data
            </v-btn>
          </v-flex>
        </v-layout>
        <v-layout justify-center>
          <v-flex
            xs12 sm6 md2
            v-for="flag in allFlag"
            :key="flag.id"
            ma-2
          >
            <v-card>
              <v-container pa-3>
                <v-layout justify-end>
                  <div class="text-xs-center">
                    <v-dialog
                      v-model="dialog"
                      width="500"
                    >
                      <v-btn flat icon color="cyan" slot="activator" class="ma-0">
                        <v-icon>settings</v-icon>
                      </v-btn>
                      <v-card>
                        <v-card-title
                          class="headline grey lighten-2"
                          primary-title
                        >
                          Privacy Policy
                        </v-card-title>

                        <v-card-text>
                          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                        </v-card-text>

                        <v-divider></v-divider>

                        <v-card-actions>
                          <v-spacer></v-spacer>
                          <v-btn
                            color="primary"
                            flat
                            @click="dialog = false"
                          >
                            I accept
                          </v-btn>
                        </v-card-actions>
                      </v-card>
                    </v-dialog>
                  </div>
                </v-layout>
                <v-layout justify-center>
                  <v-btn fab dark class="btn-size" :color="flag.status == true ? 'cyan' : 'red'" @click="changeColor(flag.status, flag.key, flag.userId)">
                    <v-icon dark class="icon-size" color="white">outlined_flag</v-icon>
                  </v-btn>
                </v-layout>
                <v-layout justify-center>
                  <v-card-title>
                    <p class="headline">{{flag.title}}</p>
                  </v-card-title>   
                </v-layout>
                <v-layout elevation-2 pa-2 v-if="flag.status === true">
                  <p class="mb-0">Your application is running here: http://localhost:8080 ls Compiled successfully in 403ms </p>
                </v-layout>
              </v-container>
            </v-card>
          </v-flex>
        </v-layout>
        <v-layout justify-center>
         
        </v-layout>
        <v-layout justify-center mb-3>  
            <v-btn flat @click="onLogout">
              Logout
            </v-btn>
        </v-layout>
    </v-content>
  </v-app>
</template>

<script>
export default {
  data () {
    return {
      title: '',
      color: 'cyan',
      dialog: false
    }
  },
  methods: {
    onLogout () {
      this.$store.dispatch('logoutUser')
      this.$router.push('/')
    },
    createFlag () {
      this.$store.dispatch('createFlag', this.title)
    },
    changeColor (status, key, userId) {
      const payload = {
        status,
        key
      }
      if(this.authUser === userId) {
        this.$store.dispatch('updateFlag', payload)
      } else {
        console.log('dont use someone else is flag')
      }
    }
  },
  computed: {
    loading () {
      return this.$store.getters.loading
    },
    allFlag () {
      return this.$store.getters.allFlag
    },
    authUser () {
      return this.$store.getters.userId
    },
    resolveAddFlag () {
      let resolve = false
      const flags = this.$store.getters.allFlag
      const authUserId = this.$store.getters.userId
      
      for (let key in flags) {
        if(flags[key].userId === authUserId) {
          resolve = false
          break
        } else {
          resolve = true
        }
      } 
      return resolve
    }
  },
  created() {
    this.$store.dispatch('realtimeUpdate')
  }
}
</script>

<style scoped>
  .btn-size{
    height: 80px;
    width: 80px;
  }
  .icon-size{
    font-size: 35px;
  }
</style>
